{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"bootchain-operator","text":"<p>bootchain-operator is a Kubernetes operator that makes service boot dependencies declarative and automatic, eliminating hand-written init containers.</p>"},{"location":"#the-problem","title":"The problem","text":"<p>In Kubernetes, services often need other services to be ready before they can start. The traditional solution is to manually write init containers for every Deployment:</p> <pre><code>initContainers:\n- name: wait-for-postgres\n  image: busybox\n  command: ['sh', '-c', 'until nc -z postgres 5432; do sleep 1; done']\n- name: wait-for-redis\n  image: busybox\n  command: ['sh', '-c', 'until nc -z redis 6379; do sleep 1; done']\n</code></pre> <p>This is repetitive, easy to get wrong, and scattered across many manifests.</p>"},{"location":"#the-solution","title":"The solution","text":"<p>With bootchain-operator, you declare dependencies once in a <code>BootDependency</code> resource:</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db   # in-cluster Kubernetes Service\n      port: 5432\n    - host: cache.example.com  # external host (DNS / IP)\n      port: 6379\n</code></pre> <p>The operator automatically injects the correct init containers into any <code>Deployment</code> with the same name, in the same namespace. No more boilerplate.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Automatic init container injection \u2014 a mutating webhook injects <code>wait-for-*</code> init containers into matching Deployments</li> <li>In-cluster and external dependencies \u2014 use <code>service</code> for Kubernetes Services in the same namespace, or <code>host</code> for external hostnames and IP addresses</li> <li>Circular dependency detection \u2014 a validating webhook blocks any <code>BootDependency</code> that would create a dependency cycle</li> <li>TCP, HTTP, and HTTPS health checks \u2014 probe dependencies with a raw TCP connection or an HTTP(S) request to a specific path (e.g. <code>/healthz</code>). Supports custom methods (<code>httpMethod</code>), request headers (<code>httpHeaders</code>), and accepted status codes (<code>httpExpectedStatuses</code>). TLS certificate verification is on by default; set <code>insecure: true</code> to accept self-signed certificates</li> <li>Status tracking \u2014 the controller continuously probes each dependency and updates <code>status.resolvedDependencies</code> (e.g. <code>2/3</code>) and <code>status.conditions</code></li> <li>Prometheus metrics \u2014 exposes reconciliation counters, duration histograms, and per-resource dependency gauges</li> <li>Helm chart \u2014 production-ready chart with cert-manager TLS, leader election, and optional ServiceMonitor</li> </ul>"},{"location":"#quick-links","title":"Quick links","text":"<ul> <li>Installation</li> <li>Quickstart</li> <li>API Reference</li> <li>Helm Values</li> <li>Metrics</li> </ul>"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>bootchain-operator is a Kubernetes operator built with Kubebuilder and controller-runtime. It consists of three components that work together:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Kubernetes API Server                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502 watch                \u2502 admission review\n           \u25bc                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Controller    \u2502    \u2502         Webhook Server          \u2502\n\u2502                 \u2502    \u2502                                 \u2502\n\u2502  Reconcile loop \u2502    \u2502  MutatingWebhook  (Deployment)  \u2502\n\u2502  TCP/HTTP check \u2502    \u2502  ValidatingWebhook (BootDep)    \u2502\n\u2502  Status update  \u2502    \u2502                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#components","title":"Components","text":""},{"location":"architecture/#controller-internalcontroller","title":"Controller (<code>internal/controller</code>)","text":"<p>The <code>BootDependencyReconciler</code> runs a reconciliation loop that:</p> <ol> <li>Fetches the <code>BootDependency</code> resource</li> <li>Probes each declared dependency (3-second timeout per check):</li> <li>If <code>httpPath</code> is set: performs an HTTP(S) request to <code>{httpScheme}://{target}:{port}{httpPath}</code>. The method defaults to <code>GET</code> (override with <code>httpMethod</code>). Custom headers can be injected via <code>httpHeaders</code>. The accepted status codes default to any <code>2xx</code>; override with <code>httpExpectedStatuses</code>. When <code>insecure: true</code>, TLS certificate verification is skipped</li> <li>Otherwise: TCP-dials the address \u2014 <code>service</code> entries resolve as <code>{service}.{namespace}.svc.cluster.local:{port}</code>, <code>host</code> entries are dialled as <code>{host}:{port}</code></li> <li>Updates <code>status.resolvedDependencies</code> (e.g. <code>\"2/3\"</code>) and the <code>Ready</code> condition</li> <li>Emits Kubernetes events for reachable/unreachable dependencies</li> <li>Records Prometheus metrics</li> <li>Requeues after 30s if all ready, 10s if not</li> </ol>"},{"location":"architecture/#mutating-webhook-internalwebhookv1","title":"Mutating Webhook (<code>internal/webhook/v1</code>)","text":"<p>The <code>DeploymentCustomDefaulter</code> fires on <code>CREATE</code> and <code>UPDATE</code> of any <code>apps/v1 Deployment</code>:</p> <ol> <li>Looks up a <code>BootDependency</code> with the same <code>name</code> and <code>namespace</code> as the Deployment</li> <li>If found, prepends a <code>wait-for-{target}</code> init container for each <code>spec.dependsOn</code> entry</li> <li>The init container target is the <code>service</code> name (cluster DNS) or <code>host</code> value (used directly)</li> <li>Injection is idempotent \u2014 existing init containers with the same name are skipped</li> </ol> <p>The init containers use the <code>ghcr.io/user-cube/bootchain-operator/minimal-tools</code> image \u2014 a custom minimal image that bundles <code>netcat</code>, <code>wget</code>, and <code>curl</code>. The polling command depends on whether <code>httpPath</code> is set and which advanced fields are in use:</p> <ul> <li>TCP check (default): <code>timeout {timeout} sh -c 'until nc -z {target} {port}; do sleep 1; done'</code></li> <li>HTTP/HTTPS check (basic \u2014 <code>httpPath</code> set, no advanced fields): uses <code>wget --spider</code>. With <code>insecure: true</code>, adds <code>--no-check-certificate</code></li> <li>Advanced HTTP/HTTPS check (<code>httpMethod</code>, <code>httpHeaders</code>, or <code>httpExpectedStatuses</code> set): switches to <code>curl</code>, which supports custom methods (<code>-X</code>), headers (<code>--header</code>), and status code extraction (<code>-w '%{http_code}'</code>). With <code>insecure: true</code>, adds <code>-k</code></li> </ul>"},{"location":"architecture/#validating-webhook-internalwebhookv1alpha1","title":"Validating Webhook (<code>internal/webhook/v1alpha1</code>)","text":"<p>The <code>BootDependencyCustomValidator</code> fires on <code>CREATE</code> and <code>UPDATE</code> of any <code>BootDependency</code>:</p> <ol> <li>Validates that each <code>spec.dependsOn</code> entry specifies exactly one of <code>service</code> or <code>host</code></li> <li>Builds a directed dependency graph from all <code>BootDependency</code> resources in the namespace (<code>service</code> entries only \u2014 <code>host</code> entries are external leaf nodes and cannot form a <code>BootDependency</code> cycle)</li> <li>Adds the incoming resource to the graph</li> <li>Runs a depth-first search (DFS) from the incoming resource's name</li> <li>Rejects the request if a back-edge (cycle) is detected, including the full cycle path in the error message</li> </ol>"},{"location":"architecture/#init-container-image-minimal-tools","title":"Init container image: minimal-tools","text":"<p>The init containers injected by the mutating webhook use a custom image \u2014 <code>ghcr.io/user-cube/bootchain-operator/minimal-tools</code> \u2014 instead of a generic <code>busybox</code>. This image is purpose-built to include exactly the tools needed for health probing:</p> Tool Used for <code>netcat</code> (<code>nc</code>) TCP connection checks (default probe) <code>wget</code> HTTP and HTTPS health checks (<code>httpPath</code>) <code>curl</code> Available for manual debugging inside init containers <p>Using a dedicated image rather than a large general-purpose one keeps the image footprint small while providing all the probing primitives the operator needs. The image is versioned and published to GitHub Container Registry alongside the operator.</p>"},{"location":"architecture/#tls-and-cert-manager","title":"TLS and cert-manager","text":"<p>The webhook server requires TLS. In production (Helm install), cert-manager automatically provisions a self-signed <code>Certificate</code> and injects the CA bundle into both <code>MutatingWebhookConfiguration</code> and <code>ValidatingWebhookConfiguration</code> via the <code>cert-manager.io/inject-ca-from</code> annotation.</p> <pre><code>cert-manager Issuer (self-signed)\n       \u2502\n       \u2514\u2500\u25ba Certificate \u2192 Secret (bootchain-operator-webhook-tls)\n                                  \u2502\n                          Deployment (volume mount)\n                                  \u2502\n                          Webhook Server (:9443)\n</code></pre>"},{"location":"architecture/#data-flow-init-container-injection","title":"Data flow: init container injection","text":"<pre><code>kubectl apply -f deployment.yaml\n        \u2502\n        \u25bc\nAPI Server \u2192 MutatingWebhookConfiguration\n        \u2502\n        \u25bc\nbootchain-operator webhook handler\n        \u2502\n        \u251c\u2500 GET BootDependency (same name, same namespace)\n        \u2502         \u2502\n        \u2502    found? \u2500\u2500yes\u2500\u2500\u25ba inject wait-for-* init containers\n        \u2502         \u2502\n        \u2502    not found? \u2500\u2500\u25ba pass through unchanged\n        \u2502\n        \u25bc\nAPI Server stores Deployment with injected init containers\n</code></pre>"},{"location":"architecture/#data-flow-cycle-detection","title":"Data flow: cycle detection","text":"<pre><code>kubectl apply -f bootdependency.yaml\n        \u2502\n        \u25bc\nAPI Server \u2192 ValidatingWebhookConfiguration\n        \u2502\n        \u25bc\nbootchain-operator webhook handler\n        \u2502\n        \u251c\u2500 LIST all BootDependencies in namespace\n        \u251c\u2500 Build directed graph (name \u2192 [dependsOn services])\n        \u251c\u2500 Add incoming resource to graph\n        \u251c\u2500 DFS from incoming resource's name\n        \u2502\n        \u251c\u2500 cycle found? \u2500\u2500\u25ba 403 Forbidden with cycle path\n        \u2514\u2500 no cycle? \u2500\u2500\u2500\u2500\u2500\u2500\u25ba 200 Allowed\n</code></pre>"},{"location":"development/","title":"Development","text":""},{"location":"development/#prerequisites","title":"Prerequisites","text":"Tool Purpose Go 1.25+ Build the operator Docker Build container images kubectl Interact with the cluster Helm 3.10+ Install / test the chart task (Taskfile) Developer workflow shortcuts kubebuilder Scaffold new APIs and webhooks <p>Install <code>task</code>: <pre><code>brew install go-task\n</code></pre></p>"},{"location":"development/#repository-layout","title":"Repository layout","text":"<pre><code>bootchain-operator/\n\u251c\u2500\u2500 api/v1alpha1/               # CRD Go types and deepcopy generation\n\u2502   \u251c\u2500\u2500 bootdependency_types.go # BootDependency spec / status structs\n\u2502   \u251c\u2500\u2500 groupversion_info.go    # API group registration\n\u2502   \u2514\u2500\u2500 zz_generated.deepcopy.go  # generated \u2014 do not edit\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 main.go                 # Entrypoint: flag parsing + manager setup\n\u251c\u2500\u2500 config/                     # Kustomize manifests (managed by kubebuilder)\n\u2502   \u251c\u2500\u2500 crd/bases/              # Generated CRD YAML \u2014 do not edit\n\u2502   \u251c\u2500\u2500 rbac/                   # Generated RBAC rules \u2014 do not edit\n\u2502   \u2514\u2500\u2500 webhook/                # Generated webhook manifest \u2014 do not edit\n\u251c\u2500\u2500 charts/bootchain-operator/  # Helm chart for cluster deployment\n\u2502   \u251c\u2500\u2500 Chart.yaml\n\u2502   \u251c\u2500\u2500 values.yaml\n\u2502   \u2514\u2500\u2500 templates/\n\u2502       \u251c\u2500\u2500 crds/               # CRD (inline, duplicated from config/crd for Helm)\n\u2502       \u251c\u2500\u2500 deployment.yaml\n\u2502       \u251c\u2500\u2500 rbac.yaml\n\u2502       \u251c\u2500\u2500 webhook.yaml\n\u2502       \u251c\u2500\u2500 certmanager.yaml    # Issuer + Certificate for webhook TLS\n\u2502       \u2514\u2500\u2500 servicemonitor.yaml # Prometheus ServiceMonitor (optional)\n\u251c\u2500\u2500 docs/                       # MkDocs documentation source\n\u251c\u2500\u2500 hack/                       # Dev helper scripts (certs, webhook registration)\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 controller/\n\u2502   \u2502   \u251c\u2500\u2500 bootdependency_controller.go  # Reconciliation loop\n\u2502   \u2502   \u2514\u2500\u2500 metrics.go                    # Custom Prometheus metrics\n\u2502   \u2514\u2500\u2500 webhook/\n\u2502       \u251c\u2500\u2500 v1/             # Mutating webhook \u2014 injects init containers into Deployments\n\u2502       \u2514\u2500\u2500 v1alpha1/       # Validating webhook \u2014 circular dependency detection\n\u251c\u2500\u2500 test/e2e/               # End-to-end tests\n\u251c\u2500\u2500 Makefile                # Kubebuilder scaffold \u2014 codegen, build, test, lint\n\u251c\u2500\u2500 Taskfile.yml            # Developer workflow \u2014 delegates to make + owns local dev tasks\n\u2514\u2500\u2500 mkdocs.yml              # Documentation site configuration\n</code></pre>"},{"location":"development/#key-areas-in-detail","title":"Key areas in detail","text":""},{"location":"development/#apiv1alpha1","title":"<code>api/v1alpha1/</code>","text":"<p>The source of truth for the <code>BootDependency</code> API surface. This is where you define the spec fields, status fields, and validation markers (<code>// +kubebuilder:validation:...</code>). After any change here, run <code>task generate</code> to regenerate <code>zz_generated.deepcopy.go</code> and the CRD YAML.</p> <p>The API group is <code>core.bootchain-operator.ruicoelho.dev</code>. The domain is defined in <code>PROJECT</code> and <code>api/v1alpha1/groupversion_info.go</code>.</p>"},{"location":"development/#cmdmaingo","title":"<code>cmd/main.go</code>","text":"<p>The binary entrypoint. Sets up the controller-runtime manager, registers the controller and both webhooks, configures TLS for the webhook server, and wires up health/readiness probes. Flags are parsed here \u2014 see <code>--help</code> for the full list.</p>"},{"location":"development/#config","title":"<code>config/</code>","text":"<p>Owned entirely by Kubebuilder tooling (<code>make manifests</code>). Contains Kustomize bases for the CRD, RBAC ClusterRoles, and webhook configurations. Do not edit these files manually \u2014 they are overwritten on every <code>make manifests</code> run. Use them as a reference or as input to Kustomize overlays for GitOps deployments.</p>"},{"location":"development/#internalcontroller","title":"<code>internal/controller/</code>","text":"<p>The reconciliation loop (<code>bootdependency_controller.go</code>) is the core of the operator. On each reconcile it:</p> <ol> <li>Fetches the <code>BootDependency</code> object</li> <li>Dials each dependency's <code>service:port</code> with a TCP connection</li> <li>Updates the <code>Ready</code> condition and <code>resolvedDependencies</code> status field</li> <li>Emits Kubernetes events</li> </ol> <p><code>metrics.go</code> registers four custom Prometheus counters/gauges/histograms via controller-runtime's shared metrics registry \u2014 they are picked up automatically by the <code>/metrics</code> endpoint.</p>"},{"location":"development/#internalwebhook","title":"<code>internal/webhook/</code>","text":"<p>Two separate packages, one per API version being intercepted:</p> <ul> <li><code>v1/</code> \u2014 Mutating webhook on <code>apps/v1 Deployment</code>. Looks up a <code>BootDependency</code> with the same name in the same namespace and, if found, injects one <code>initContainer</code> per declared dependency. Uses <code>netcat</code> for TCP probes and <code>wget</code> for HTTP/HTTPS probes, sourced from the custom <code>minimal-tools</code> image.</li> <li><code>v1alpha1/</code> \u2014 Validating webhook on <code>BootDependency</code> CREATE/UPDATE. Builds the full dependency graph for the namespace and runs a DFS cycle-detection algorithm before admitting the object.</li> </ul>"},{"location":"development/#chartsbootchain-operator","title":"<code>charts/bootchain-operator/</code>","text":"<p>The production Helm chart. The CRD template is a copy of the generated CRD from <code>config/crd/bases/</code> \u2014 keep them in sync when the API changes (run <code>task generate</code> then copy). The chart integrates with cert-manager via the <code>cert-manager.io/inject-ca-from</code> annotation on the webhook configurations, which eliminates the need to manage CA bundles manually.</p>"},{"location":"development/#hack","title":"<code>hack/</code>","text":"<p>Shell scripts for local development only \u2014 none of these are included in the Docker image:</p> Script Purpose <code>gen-dev-certs.sh</code> Generates a self-signed CA + TLS cert/key for local webhook dev <code>register-dev-webhook.sh</code> Registers <code>MutatingWebhookConfiguration</code> and <code>ValidatingWebhookConfiguration</code> pointing at the local process"},{"location":"development/#makefile-vs-taskfileyml","title":"<code>Makefile</code> vs <code>Taskfile.yml</code>","text":"<p>The <code>Makefile</code> is the Kubebuilder scaffold and owns code generation, building, testing, and linting. It should not be customised \u2014 Kubebuilder may overwrite parts of it on <code>kubebuilder init</code> or plugin upgrades.</p> <p><code>Taskfile.yml</code> is the developer-facing interface. It delegates to <code>make</code> for codegen/build/test targets and directly owns everything else: local cluster setup, webhook dev workflow, Helm, and docs. Run <code>task --list</code> to see all available tasks.</p>"},{"location":"development/#what-lives-where","title":"What lives where","text":"Area Owned by Notes <code>api/</code> Kubebuilder + developer Edit types here; run <code>task generate</code> after <code>config/</code> Kubebuilder (<code>make manifests</code>) Never edit manually <code>internal/controller/</code> Developer Reconciliation logic and metrics <code>internal/webhook/</code> Developer Admission webhook handlers <code>charts/</code> Developer Helm chart; CRD kept in sync with <code>config/crd/bases/</code> <code>hack/</code> Developer Local dev scripts; not shipped in the image <code>Makefile</code> Kubebuilder scaffold Codegen targets; avoid adding custom tasks here <code>Taskfile.yml</code> Developer All local dev / Helm / docs tasks"},{"location":"development/#common-tasks","title":"Common tasks","text":"<pre><code>task --list         # show all available tasks\ntask build          # compile the operator binary\ntask test           # run unit and controller tests\ntask lint           # run golangci-lint\ntask generate       # regenerate DeepCopy methods and CRD manifests\ntask fmt            # format Go source files\ntask vet            # run go vet\n</code></pre>"},{"location":"development/#running-locally-controller-only","title":"Running locally (controller only)","text":"<pre><code>task install-crd    # apply CRD to current cluster\ntask run            # run controller with ENABLE_WEBHOOKS=false\n</code></pre>"},{"location":"development/#running-locally-with-webhooks","title":"Running locally with webhooks","text":"<p>Webhooks require a valid TLS certificate reachable from the cluster. The scripts in <code>hack/</code> automate the setup for a local Colima/k3s cluster:</p> <pre><code>task webhook-setup        # generates certs + registers webhooks + labels namespace\ntask webhook-proxy        # socat proxy: TCP4:9444 \u2192 TCP6:[::1]:9443 (Colima networking)\ntask run-with-webhook     # start operator with webhook server\n</code></pre> <p>Colima networking</p> <p>When using Colima with a self-managed k3s cluster, the Mac host is reachable from the cluster at <code>192.168.64.1</code> (bridge100 interface). Always set <code>HOST_IP=192.168.64.1</code> when registering webhooks: <pre><code>HOST_IP=192.168.64.1 task webhook-setup\n</code></pre></p>"},{"location":"development/#code-generation","title":"Code generation","text":"<p>After modifying types in <code>api/v1alpha1/</code>, regenerate:</p> <pre><code>task generate   # regenerates zz_generated.deepcopy.go\n                # and config/crd/bases/*.yaml\n</code></pre> <p>Warning</p> <p>Never edit <code>zz_generated.deepcopy.go</code> or <code>config/crd/bases/*.yaml</code> manually \u2014 they are overwritten by <code>make generate manifests</code>.</p>"},{"location":"development/#testing","title":"Testing","text":"<p>Tests use Ginkgo and Gomega with <code>envtest</code> (a real API server + etcd, no cluster needed).</p> <pre><code>task test\n</code></pre> <p>Test files: - <code>internal/controller/bootdependency_controller_test.go</code> \u2014 controller reconciliation - <code>internal/webhook/v1/deployment_webhook_test.go</code> \u2014 mutating webhook - <code>internal/webhook/v1alpha1/bootdependency_webhook_test.go</code> \u2014 validating webhook (cycle detection)</p>"},{"location":"development/#adding-a-new-api","title":"Adding a new API","text":"<pre><code>kubebuilder create api \\\n  --group core \\\n  --version v1alpha1 \\\n  --kind MyResource\n</code></pre>"},{"location":"development/#adding-a-new-webhook","title":"Adding a new webhook","text":"<pre><code>kubebuilder create webhook \\\n  --group apps \\\n  --version v1 \\\n  --kind Deployment \\\n  --defaulting\n</code></pre>"},{"location":"development/#helm-chart-development","title":"Helm chart development","text":"<pre><code>task helm-lint                  # lint the chart\ntask helm-template              # render templates to stdout\ntask helm-install               # install into current cluster\ntask helm-uninstall             # remove from cluster\n</code></pre>"},{"location":"examples/","title":"Examples","text":"<p>Real-world patterns for using bootchain-operator. Each example includes the full YAML needed and explains what to expect.</p>"},{"location":"examples/#dependency-patterns","title":"Dependency patterns","text":""},{"location":"examples/#simple-dependency","title":"Simple dependency","text":"<p>A single service waiting for one upstream.</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: worker\n  namespace: default\nspec:\n  dependsOn:\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <p>When a <code>Deployment</code> named <code>worker</code> is created in the same namespace, the operator injects one init container that waits until <code>redis:6379</code> accepts TCP connections.</p>"},{"location":"examples/#chain-dependency-a-b-c","title":"Chain dependency (A \u2192 B \u2192 C)","text":"<p>Services that must start in sequence. Each <code>BootDependency</code> declares only its direct upstream.</p> <pre><code># database \u2014 no dependencies, starts immediately\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: database\n  namespace: default\nspec:\n  dependsOn:\n    - service: postgres\n      port: 5432\n      timeout: 120s\n---\n# api \u2014 waits for database\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: api\n  namespace: default\nspec:\n  dependsOn:\n    - service: database\n      port: 8080\n      timeout: 60s\n---\n# frontend \u2014 waits for api\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: frontend\n  namespace: default\nspec:\n  dependsOn:\n    - service: api\n      port: 3000\n      timeout: 60s\n</code></pre> <p>Start order enforced: <code>postgres</code> \u2192 <code>database</code> \u2192 <code>api</code> \u2192 <code>frontend</code>.</p>"},{"location":"examples/#fan-in-dependency-multiple-upstreams","title":"Fan-in dependency (multiple upstreams)","text":"<p>A service that requires several independent services before starting.</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 120s\n    - service: redis\n      port: 6379\n      timeout: 30s\n    - service: kafka\n      port: 9092\n      timeout: 60s\n</code></pre> <p>Three init containers are injected. The application pod only starts once all three services are reachable.</p>"},{"location":"examples/#external-host-dependency","title":"External host dependency","text":"<p>Use <code>host</code> instead of <code>service</code> when the dependency lives outside the cluster \u2014 a managed database, an external API, or any hostname/IP reachable from inside the cluster.</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - host: db.example.com       # external managed database\n      port: 5432\n      timeout: 120s\n    - service: redis             # in-cluster cache\n      port: 6379\n      timeout: 30s\n</code></pre> <p><code>service</code> and <code>host</code> entries can be mixed freely. Each entry must specify exactly one of the two \u2014 the validating webhook rejects entries with both set or neither set.</p> <p>Note</p> <p><code>host</code> dependencies are resolved directly by the init container without DNS look-up via <code>svc.cluster.local</code>. They are also excluded from cycle detection since external hosts cannot form a <code>BootDependency</code> cycle.</p>"},{"location":"examples/#http-health-check","title":"HTTP health check","text":"<p>Use <code>httpPath</code> to probe an HTTP endpoint instead of doing a raw TCP connection. The check performs an HTTP GET and requires a <code>2xx</code> response before the init container exits. This is useful when a service binds its port before it is fully initialised and exposes a dedicated health endpoint.</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: frontend\n  namespace: default\nspec:\n  dependsOn:\n    - service: backend\n      port: 8080\n      httpPath: /healthz       # waits for HTTP 200 on http://backend:8080/healthz\n      timeout: 60s\n    - host: api.example.com    # external API with a health endpoint\n      port: 443\n      httpPath: /health\n      timeout: 30s\n    - service: postgres\n      port: 5432               # no httpPath \u2192 plain TCP check\n      timeout: 120s\n</code></pre> <p><code>service</code> and <code>host</code> entries can freely mix TCP and HTTP checks within the same <code>BootDependency</code>.</p>"},{"location":"examples/#advanced-http-check-custom-method-headers-and-status-codes","title":"Advanced HTTP check (custom method, headers, and status codes)","text":"<p>Use <code>httpMethod</code>, <code>httpHeaders</code>, and <code>httpExpectedStatuses</code> when a simple <code>GET</code>/<code>2xx</code> check is not enough. Common cases: endpoints that only accept <code>HEAD</code>, return <code>204</code>, or require an <code>Authorization</code> header.</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: auth-service\n      port: 8080\n      httpPath: /healthz\n      httpMethod: POST                   # probe with POST\n      httpHeaders:\n        - name: Authorization\n          value: Bearer my-bootstrap-token\n        - name: X-Probe-Source\n          value: bootchain\n      httpExpectedStatuses: [200, 204]   # accept 200 or 204\n      timeout: 30s\n    - service: metrics-svc\n      port: 9090\n      httpPath: /-/healthy\n      httpMethod: HEAD                   # lightweight HEAD probe\n      timeout: 10s\n    - service: storage\n      port: 8080\n      httpPath: /ping\n      httpExpectedStatuses: [204]        # ping returns 204 No Content\n      timeout: 20s\n</code></pre> <p>When <code>httpMethod</code>, <code>httpHeaders</code>, or <code>httpExpectedStatuses</code> are set, the init container uses <code>curl</code> instead of <code>wget</code>. With none of these fields, <code>wget --spider</code> is used (backward-compatible).</p> <p>Note</p> <p><code>httpMethod</code>, <code>httpHeaders</code>, and <code>httpExpectedStatuses</code> all require <code>httpPath</code> to be set. The API server rejects resources that specify any of these fields without <code>httpPath</code>.</p>"},{"location":"examples/#https-health-check","title":"HTTPS health check","text":"<p>Use <code>httpScheme: https</code> together with <code>httpPath</code> to probe an HTTPS endpoint. By default TLS certificates are verified. Set <code>insecure: true</code> to skip verification (useful for services with self-signed certificates).</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: frontend\n  namespace: default\nspec:\n  dependsOn:\n    - host: secure-api.example.com   # external HTTPS API \u2014 full TLS verification\n      port: 443\n      httpPath: /healthz\n      httpScheme: https\n      timeout: 60s\n    - service: internal-api          # in-cluster service with self-signed cert\n      port: 8443\n      httpPath: /ready\n      httpScheme: https\n      insecure: true                 # skip TLS verification\n      timeout: 30s\n    - service: postgres              # plain TCP check \u2014 no httpPath\n      port: 5432\n      timeout: 120s\n</code></pre> <p>Note</p> <p><code>insecure: true</code> only skips TLS certificate verification. The connection is still encrypted. Use it for services with self-signed or internal CA certificates that are not in the system trust store.</p> <p>Warning</p> <p>Both <code>httpScheme</code> and <code>insecure</code> require <code>httpPath</code> to be set. The API server rejects resources that specify either field without <code>httpPath</code>.</p>"},{"location":"examples/#circular-dependency-rejected","title":"Circular dependency (rejected)","text":"<p>The validating webhook blocks cycles at admission time.</p> <pre><code># Apply svc-a first \u2014 succeeds\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: svc-a\n  namespace: default\nspec:\n  dependsOn:\n    - service: svc-b\n      port: 8080\n</code></pre> <pre><code># Apply svc-b \u2014 rejected\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: svc-b\n  namespace: default\nspec:\n  dependsOn:\n    - service: svc-a\n      port: 8080\n</code></pre> <pre><code>Error from server (Forbidden): admission webhook \"vbootdependency-v1alpha1.kb.io\" denied the request:\nspec.dependsOn: Invalid value: ...: circular dependency detected: svc-b \u2192 svc-a \u2192 svc-b\n</code></pre>"},{"location":"examples/#common-use-cases","title":"Common use cases","text":""},{"location":"examples/#web-application-with-database-and-cache","title":"Web application with database and cache","text":"<p>A typical three-tier application: PostgreSQL + Redis + app server.</p> BootDependencyDeployment <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: web-app\n  namespace: production\nspec:\n  dependsOn:\n    - service: postgres\n      port: 5432\n      timeout: 120s\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-app        # must match BootDependency name\n  namespace: production\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-app\n  template:\n    metadata:\n      labels:\n        app: web-app\n    spec:\n      containers:\n        - name: app\n          image: my-org/web-app:1.0.0\n          env:\n            - name: DB_HOST\n              value: postgres\n            - name: CACHE_HOST\n              value: redis\n</code></pre> <p>After applying both, the operator injects init containers automatically:</p> <pre><code>kubectl get deployment web-app \\\n  -o jsonpath='{.spec.template.spec.initContainers[*].name}'\n# wait-for-postgres wait-for-redis\n</code></pre>"},{"location":"examples/#message-queue-consumer","title":"Message queue consumer","text":"<p>A worker that must wait for both the queue broker and its database before consuming messages.</p> BootDependencyDeployment <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: order-consumer\n  namespace: default\nspec:\n  dependsOn:\n    - service: rabbitmq\n      port: 5672\n      timeout: 90s\n    - service: orders-db\n      port: 5432\n      timeout: 120s\n</code></pre> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: order-consumer\n  namespace: default\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: order-consumer\n  template:\n    metadata:\n      labels:\n        app: order-consumer\n    spec:\n      containers:\n        - name: consumer\n          image: my-org/order-consumer:1.0.0\n</code></pre>"},{"location":"examples/#microservices-with-staged-rollout","title":"Microservices with staged rollout","text":"<p>In a microservices architecture, declare dependencies explicitly to enforce a safe rollout order.</p> <pre><code># infrastructure layer\n---\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: auth-service\n  namespace: apps\nspec:\n  dependsOn:\n    - service: auth-db\n      port: 5432\n      timeout: 120s\n---\n# business logic layer \u2014 waits for auth\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: order-service\n  namespace: apps\nspec:\n  dependsOn:\n    - service: auth-service\n      port: 8080\n      timeout: 60s\n    - service: order-db\n      port: 5432\n      timeout: 120s\n---\n# gateway layer \u2014 waits for all business services\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: api-gateway\n  namespace: apps\nspec:\n  dependsOn:\n    - service: auth-service\n      port: 8080\n      timeout: 60s\n    - service: order-service\n      port: 8080\n      timeout: 60s\n</code></pre>"},{"location":"examples/#troubleshooting","title":"Troubleshooting","text":""},{"location":"examples/#pod-stuck-in-init0n","title":"Pod stuck in <code>Init:0/N</code>","text":"<p>The init containers are running but the upstream services are not yet reachable.</p> <pre><code># Check which init containers are waiting\nkubectl get pod -l app=my-app\n\n# NAME                     READY   STATUS     RESTARTS   AGE\n# my-app-xxx-yyy           0/1     Init:0/2   0          45s\n\n# Describe the pod to see which dependency is blocking\nkubectl describe pod -l app=my-app\n</code></pre> <p>Look for lines like:</p> <pre><code>Init Containers:\n  wait-for-payments-db:\n    State: Running\n    ...\n  wait-for-redis:\n    State: Waiting\n      Reason: PodInitializing\n</code></pre> <p>The first init container runs serially \u2014 if <code>wait-for-payments-db</code> is still running, it means <code>payments-db:5432</code> is not yet accepting connections.</p>"},{"location":"examples/#bootdependency-shows-ready-false","title":"BootDependency shows <code>Ready: False</code>","text":"<pre><code>kubectl get bootdependency my-app\n# NAME     READY   RESOLVED   AGE\n# my-app   False   1/2        2m\n</code></pre> <p><code>1/2</code> means one dependency is reachable and one is not. Check which:</p> <pre><code>kubectl describe bootdependency my-app\n</code></pre> <p>Look at the <code>Conditions</code> and <code>Events</code> sections. The controller emits an event per unreachable dependency.</p>"},{"location":"examples/#service-exists-but-dependency-never-becomes-ready","title":"Service exists but dependency never becomes ready","text":"<p>Verify the service name and port match exactly:</p> <pre><code># Check the service exists and its port\nkubectl get service payments-db\nkubectl get service payments-db -o jsonpath='{.spec.ports[*].port}'\n</code></pre> <p>Common mistakes:</p> Mistake Symptom Wrong service name (typo) Init container loops forever Wrong port Init container loops forever Service in different namespace Init container loops forever (cross-namespace not supported) <code>timeout</code> too short Pod restarts repeatedly <p>Note</p> <p><code>BootDependency</code> and the <code>Deployment</code> must be in the same namespace. The operator looks up the <code>BootDependency</code> by matching its name to the <code>Deployment</code> name within the same namespace.</p>"},{"location":"examples/#admission-webhook-rejected-a-valid-resource","title":"Admission webhook rejected a valid resource","text":"<p>If you get an unexpected rejection:</p> <pre><code># Check webhook is running\nkubectl get pods -n bootchain-operator-system\n\n# Check webhook logs\nkubectl logs -n bootchain-operator-system -l app.kubernetes.io/name=bootchain-operator\n</code></pre> <p>If the cycle detection false-positives, describe all <code>BootDependency</code> objects in the namespace to visualise the graph:</p> <pre><code>kubectl get bootdependency -A \\\n  -o custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,SERVICES:.spec.dependsOn[*].service,HOSTS:.spec.dependsOn[*].host'\n</code></pre>"},{"location":"examples/#webhook-not-injecting-init-containers","title":"Webhook not injecting init containers","text":"<p>If a <code>Deployment</code> exists but no init containers were injected:</p> <ol> <li>Confirm a <code>BootDependency</code> with the same name exists in the same namespace</li> <li>Check the operator pod is running and webhooks are registered:</li> </ol> <pre><code>kubectl get mutatingwebhookconfigurations\nkubectl get validatingwebhookconfigurations\n</code></pre> <ol> <li>If using <code>ENABLE_WEBHOOKS=false</code> (local dev mode), webhooks are disabled by design \u2014 use <code>task run-with-webhook</code> instead.</li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"Requirement Version Kubernetes &gt;= 1.25 Helm &gt;= 3.10 cert-manager &gt;= 1.13 (for webhook TLS)"},{"location":"getting-started/installation/#install-cert-manager","title":"Install cert-manager","text":"<p>The operator uses cert-manager to automatically provision and rotate the TLS certificate for its admission webhooks.</p> <pre><code>helm repo add jetstack https://charts.jetstack.io --force-update\nhelm install cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --set crds.enabled=true \\\n  --wait\n</code></pre>"},{"location":"getting-started/installation/#install-bootchain-operator","title":"Install bootchain-operator","text":"<pre><code>helm install bootchain-operator oci://ghcr.io/user-cube/bootchain-operator/bootchain-operator \\\n  --namespace bootchain-operator-system \\\n  --create-namespace \\\n  --wait\n</code></pre> <p>Verify the installation:</p> <pre><code>kubectl get all -n bootchain-operator-system\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                     READY   STATUS    RESTARTS   AGE\npod/bootchain-operator-xxx-yyy           1/1     Running   0          30s\n\nNAME                                 TYPE        CLUSTER-IP    PORT(S)    AGE\nservice/bootchain-operator-metrics   ClusterIP   10.x.x.x      8080/TCP   30s\nservice/bootchain-operator-webhook   ClusterIP   10.x.x.x      443/TCP    30s\n\nNAME                                 READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/bootchain-operator   1/1     1            1           30s\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from source","text":"<pre><code>git clone https://github.com/user-cube/bootchain-operator\ncd bootchain-operator\n\nhelm install bootchain-operator charts/bootchain-operator \\\n  --namespace bootchain-operator-system \\\n  --create-namespace \\\n  --wait\n</code></pre>"},{"location":"getting-started/installation/#uninstall","title":"Uninstall","text":"<pre><code>helm uninstall bootchain-operator --namespace bootchain-operator-system\n</code></pre> <p>CRD retention</p> <p>By default, the CRD is annotated with <code>helm.sh/resource-policy: keep</code> and will not be deleted on uninstall. This protects your existing <code>BootDependency</code> resources.</p> <p>To also delete the CRD, run: <pre><code>kubectl delete crd bootdependencies.core.bootchain-operator.ruicoelho.dev\n</code></pre></p>"},{"location":"getting-started/quickstart/","title":"Quickstart","text":"<p>This guide walks through a complete example: declaring that <code>payments-api</code> depends on <code>payments-db</code> (PostgreSQL) and <code>redis</code>, and verifying that init containers are automatically injected.</p>"},{"location":"getting-started/quickstart/#1-create-a-bootdependency","title":"1. Create a BootDependency","text":"payments-api-deps.yaml<pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <pre><code>kubectl apply -f payments-api-deps.yaml\n</code></pre> <p>Check the status:</p> <pre><code>kubectl get bootdependency payments-api\n</code></pre> <pre><code>NAME           READY   RESOLVED   AGE\npayments-api   False   0/2        5s\n</code></pre> <p>The <code>READY</code> column reflects reachability. <code>0/2</code> means neither dependency is reachable yet \u2014 the services don't exist. That's expected.</p>"},{"location":"getting-started/quickstart/#2-deploy-the-application","title":"2. Deploy the application","text":"<p>Create a Deployment with the same name as the BootDependency, in the same namespace:</p> payments-api-deploy.yaml<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: payments-api\n  template:\n    metadata:\n      labels:\n        app: payments-api\n    spec:\n      containers:\n      - name: app\n        image: nginx\n</code></pre> <pre><code>kubectl apply -f payments-api-deploy.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#3-verify-init-containers-were-injected","title":"3. Verify init containers were injected","text":"<pre><code>kubectl get deployment payments-api \\\n  -o jsonpath='{.spec.template.spec.initContainers[*].name}'\n</code></pre> <pre><code>wait-for-payments-db wait-for-redis\n</code></pre> <p>The operator automatically injected two init containers. Describe the pod to see them in action:</p> <pre><code>kubectl describe pod -l app=payments-api\n</code></pre> <p>The pod will stay in <code>Init:0/2</code> until both <code>payments-db:5432</code> and <code>redis:6379</code> are reachable.</p>"},{"location":"getting-started/quickstart/#4-external-host-dependency","title":"4. External host dependency","text":"<p>Use <code>host</code> instead of <code>service</code> when the dependency lives outside the cluster:</p> payments-api-deps-external.yaml<pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - host: db.example.com\n      port: 5432\n      timeout: 120s\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <p>The init container for the <code>host</code> entry dials <code>db.example.com:5432</code> directly (no cluster DNS suffix). <code>service</code> and <code>host</code> entries can be mixed freely.</p>"},{"location":"getting-started/quickstart/#5-http-health-check","title":"5. HTTP health check","text":"<p>Use <code>httpPath</code> to probe an HTTP endpoint instead of a raw TCP connection. Useful when a service binds its port before it is fully ready and exposes a <code>/healthz</code> or <code>/ready</code> endpoint:</p> payments-api-deps-http.yaml<pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - service: auth-service\n      port: 8080\n      httpPath: /healthz      # HTTP GET \u2014 waits for 2xx\n      timeout: 30s\n</code></pre> <p>The injected init container for <code>auth-service</code> will use <code>wget --spider</code> instead of <code>nc -z</code>, and only exit once it receives a <code>2xx</code> response.</p>"},{"location":"getting-started/quickstart/#6-advanced-http-check-custom-method-headers-status-codes","title":"6. Advanced HTTP check (custom method, headers, status codes)","text":"<p>Use <code>httpMethod</code>, <code>httpHeaders</code>, and <code>httpExpectedStatuses</code> when the default <code>GET</code>/<code>2xx</code> probe is not sufficient:</p> payments-api-deps-advanced.yaml<pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - service: auth-service\n      port: 8080\n      httpPath: /healthz\n      httpMethod: POST                   # probe with POST instead of GET\n      httpHeaders:\n        - name: Authorization\n          value: Bearer bootstrap-token  # endpoint requires auth\n      httpExpectedStatuses: [200, 204]   # accept 200 or 204\n      timeout: 30s\n</code></pre> <p>When any of these fields are set, the init container uses <code>curl</code> (instead of <code>wget</code>) to support custom methods, headers, and precise status code matching.</p>"},{"location":"getting-started/quickstart/#7-https-health-check","title":"7. HTTPS health check","text":"<p>Add <code>httpScheme: https</code> to probe an HTTPS endpoint. Certificate verification is on by default \u2014 set <code>insecure: true</code> to accept self-signed certificates:</p> payments-api-deps-https.yaml<pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - host: secure-api.example.com   # external HTTPS API\n      port: 443\n      httpPath: /healthz\n      httpScheme: https              # use HTTPS instead of HTTP\n      timeout: 30s\n    - service: internal-svc          # in-cluster service with self-signed cert\n      port: 8443\n      httpPath: /ready\n      httpScheme: https\n      insecure: true                 # skip TLS certificate verification\n      timeout: 30s\n</code></pre>"},{"location":"getting-started/quickstart/#8-circular-dependency-detection","title":"8. Circular dependency detection","text":"<p>The validating webhook blocks dependency cycles. Try creating a cycle:</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: svc-a\n  namespace: default\nspec:\n  dependsOn:\n  - service: svc-b\n    port: 8080\n</code></pre> <pre><code>kubectl apply -f svc-a.yaml\n# bootdependency.core.bootchain-operator.ruicoelho.dev/svc-a created\n</code></pre> <p>Now try creating <code>svc-b</code> that depends back on <code>svc-a</code>:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: svc-b\n  namespace: default\nspec:\n  dependsOn:\n  - service: svc-a\n    port: 8080\nEOF\n</code></pre> <pre><code>Error from server (Forbidden): admission webhook \"vbootdependency-v1alpha1.kb.io\" denied the request:\nspec.dependsOn: Invalid value: ...: circular dependency detected: svc-b \u2192 svc-a \u2192 svc-b\n</code></pre> <p>The cycle is blocked with a clear error message.</p>"},{"location":"getting-started/quickstart/#next-steps","title":"Next steps","text":"<ul> <li>See more patterns (fan-in, chains, external hosts, HTTP/HTTPS/advanced checks) in the Examples</li> <li>Learn about all available fields in the API Reference</li> <li>Configure the Helm chart with Helm Values</li> <li>Monitor the operator with Metrics</li> </ul>"},{"location":"reference/api/","title":"API Reference","text":""},{"location":"reference/api/#bootdependency","title":"BootDependency","text":"<p>Group: <code>core.bootchain-operator.ruicoelho.dev</code> Version: <code>v1alpha1</code> Scope: Namespaced</p> <p>A <code>BootDependency</code> declares the set of services that must be reachable before a <code>Deployment</code> with the same name (in the same namespace) is allowed to start. The operator injects <code>wait-for-*</code> init containers automatically. Each dependency can be probed via a raw TCP check, an HTTP health endpoint, or an HTTPS health endpoint.</p>"},{"location":"reference/api/#spec","title":"Spec","text":"<pre><code>spec:\n  dependsOn:\n    - service: &lt;string&gt;              # exactly one of service or host is required\n      port: &lt;integer&gt;                # required\n      httpPath: &lt;string&gt;             # optional, enables HTTP(S) check (e.g. /healthz)\n      httpScheme: &lt;string&gt;           # optional, \"http\" or \"https\" (default: \"http\")\n      insecure: &lt;boolean&gt;            # optional, skip TLS verification (default: false)\n      httpMethod: &lt;string&gt;           # optional, HTTP verb (default: \"GET\")\n      httpHeaders:                   # optional, custom request headers\n        - name: &lt;string&gt;\n          value: &lt;string&gt;\n      httpExpectedStatuses: [&lt;int&gt;]  # optional, accepted status codes (default: 2xx)\n      timeout: &lt;string&gt;              # optional, default: \"60s\"\n\n    - host: &lt;string&gt;                 # use for external dependencies (DNS / IP)\n      port: &lt;integer&gt;\n      httpPath: &lt;string&gt;\n      httpScheme: &lt;string&gt;\n      insecure: &lt;boolean&gt;\n      httpMethod: &lt;string&gt;\n      httpHeaders:\n        - name: &lt;string&gt;\n          value: &lt;string&gt;\n      httpExpectedStatuses: [&lt;int&gt;]\n      timeout: &lt;string&gt;\n</code></pre>"},{"location":"reference/api/#specdependson","title":"<code>spec.dependsOn</code>","text":"<p>List of dependencies. At least one entry is required. Each entry must specify exactly one of <code>service</code> or <code>host</code>.</p> Field Type Required Description <code>service</code> string one of <code>service</code>/<code>host</code> Name of the Kubernetes <code>Service</code> in the same namespace to wait for <code>host</code> string one of <code>service</code>/<code>host</code> External hostname or IP address to wait for (e.g. a managed database, an external API) <code>port</code> integer (1\u201365535) yes TCP port to probe <code>httpPath</code> string no HTTP(S) path to probe instead of a raw TCP check (e.g. <code>/healthz</code>). Must start with <code>/</code>. When set, the check performs an HTTP GET and requires a <code>2xx</code> response. When omitted, a plain TCP connection check is used <code>httpScheme</code> <code>http</code> | <code>https</code> no URL scheme to use when <code>httpPath</code> is set. Defaults to <code>http</code>. Requires <code>httpPath</code> to be set <code>insecure</code> boolean no When <code>true</code>, TLS certificate verification is skipped for HTTPS probes (accepts self-signed certificates). Defaults to <code>false</code>. Requires <code>httpPath</code> to be set <code>httpMethod</code> string no HTTP verb to use for the probe (e.g. <code>GET</code>, <code>POST</code>, <code>HEAD</code>). Must be uppercase. Defaults to <code>GET</code>. Requires <code>httpPath</code> to be set <code>httpHeaders</code> <code>[{name, value}]</code> no List of custom HTTP headers to include in the probe request (e.g. <code>Authorization</code>). Requires <code>httpPath</code> to be set <code>httpExpectedStatuses</code> <code>[]integer</code> no List of HTTP status codes accepted as healthy. Defaults to any <code>2xx</code> (200\u2013299). Useful for endpoints that return <code>204 No Content</code>. Requires <code>httpPath</code> to be set <code>timeout</code> duration string no How long to wait per dependency. Defaults to <code>60s</code>"},{"location":"reference/api/#status","title":"Status","text":"<p>The operator updates the status after each reconciliation loop.</p> Field Type Description <code>conditions</code> []Condition Standard Kubernetes conditions. The <code>Ready</code> condition reflects overall reachability <code>resolvedDependencies</code> string Human-readable summary, e.g. <code>\"2/3\"</code>"},{"location":"reference/api/#ready-condition","title":"Ready condition","text":"Status Reason Description <code>True</code> <code>AllDependenciesReady</code> All declared dependencies are reachable <code>False</code> <code>DependenciesNotReady</code> One or more dependencies are not reachable"},{"location":"reference/api/#printer-columns","title":"Printer columns","text":"<pre><code>kubectl get bootdependencies\n</code></pre> <pre><code>NAME           READY   RESOLVED   AGE\npayments-api   True    2/2        5m\nsvc-a          False   0/1        1m\n</code></pre>"},{"location":"reference/api/#examples","title":"Examples","text":"<p>In-cluster services:</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <p>External dependencies (outside the cluster):</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - host: db.example.com\n      port: 5432\n      timeout: 120s\n    - service: redis\n      port: 6379\n      timeout: 30s\n</code></pre> <p>HTTP health check (probe an endpoint instead of raw TCP):</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: payments-db\n      port: 5432\n      timeout: 60s\n    - service: auth-service\n      port: 8080\n      httpPath: /healthz\n      timeout: 30s\n    - host: api.example.com\n      port: 443\n      httpPath: /health\n      timeout: 60s\n</code></pre> <p>Advanced HTTP check (custom method, headers, and accepted status codes):</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - service: auth-service\n      port: 8080\n      httpPath: /healthz\n      httpMethod: POST                       # use POST instead of GET\n      httpHeaders:\n        - name: Authorization\n          value: Bearer my-token             # required by the endpoint\n        - name: X-Probe-Source\n          value: bootchain\n      httpExpectedStatuses: [200, 204]       # accept 200 or 204\n      timeout: 30s\n</code></pre> <p>HTTPS health check (with TLS certificate verification):</p> <pre><code>apiVersion: core.bootchain-operator.ruicoelho.dev/v1alpha1\nkind: BootDependency\nmetadata:\n  name: payments-api\n  namespace: default\nspec:\n  dependsOn:\n    - host: secure-api.example.com   # external HTTPS API\n      port: 443\n      httpPath: /healthz\n      httpScheme: https\n      timeout: 60s\n    - service: internal-https-svc    # in-cluster service with self-signed cert\n      port: 8443\n      httpPath: /ready\n      httpScheme: https\n      insecure: true                 # skip TLS verification\n      timeout: 30s\n</code></pre>"},{"location":"reference/api/#naming-convention","title":"Naming convention","text":"<p>The <code>BootDependency</code> name must match the <code>Deployment</code> name it targets. The operator looks up a <code>BootDependency</code> whose <code>metadata.name</code> equals the Deployment's <code>metadata.name</code> in the same namespace.</p> <pre><code>Deployment: payments-api  \u2192  BootDependency: payments-api  (same namespace)\n</code></pre>"},{"location":"reference/api/#injected-init-containers","title":"Injected init containers","text":"<p>For each entry in <code>spec.dependsOn</code>, the mutating webhook prepends an init container to the Deployment's pod template. The target address is the <code>service</code> name (resolved via cluster DNS) or the <code>host</code> value (used directly).</p> <p>TCP check (default, when <code>httpPath</code> is omitted):</p> <pre><code>initContainers:\n- name: wait-for-payments-db\n  image: ghcr.io/user-cube/bootchain-operator/minimal-tools:1.2.0\n  imagePullPolicy: IfNotPresent\n  command:\n  - sh\n  - -c\n  - \"echo 'Waiting for payments-db:5432...'; timeout 60s sh -c 'until nc -z payments-db 5432; do sleep 1; done'; echo 'payments-db:5432 is ready'\"\n</code></pre> <p>HTTP check (when <code>httpPath</code> is set):</p> <pre><code>initContainers:\n- name: wait-for-auth-service\n  image: ghcr.io/user-cube/bootchain-operator/minimal-tools:1.2.0\n  imagePullPolicy: IfNotPresent\n  command:\n  - sh\n  - -c\n  - \"echo 'Waiting for http://auth-service:8080/healthz...'; timeout 30s sh -c 'until wget -q --spider http://auth-service:8080/healthz; do sleep 1; done'; echo 'http://auth-service:8080/healthz is ready'\"\n</code></pre> <p>HTTPS check (when <code>httpPath</code> and <code>httpScheme: https</code> are set):</p> <pre><code>initContainers:\n- name: wait-for-secure-api\n  image: ghcr.io/user-cube/bootchain-operator/minimal-tools:1.2.0\n  imagePullPolicy: IfNotPresent\n  command:\n  - sh\n  - -c\n  - \"echo 'Waiting for https://secure-api:443/healthz...'; timeout 60s sh -c 'until wget -q --spider https://secure-api:443/healthz; do sleep 1; done'; echo 'https://secure-api:443/healthz is ready'\"\n</code></pre> <p>With <code>insecure: true</code>, <code>--no-check-certificate</code> is added to the <code>wget</code> command to skip TLS verification.</p> <p>Advanced HTTP check (when <code>httpMethod</code>, <code>httpHeaders</code>, or <code>httpExpectedStatuses</code> are set \u2014 switches to <code>curl</code>):</p> <pre><code>initContainers:\n- name: wait-for-auth-service\n  image: ghcr.io/user-cube/bootchain-operator/minimal-tools:1.2.0\n  imagePullPolicy: IfNotPresent\n  command:\n  - sh\n  - -c\n  - \"echo 'Waiting for http://auth-service:8080/healthz...'; timeout 30s sh -c 'until STATUS=$(curl -s -o /dev/null -w \\\"%{http_code}\\\" -X POST --header \\\"Authorization: Bearer my-token\\\" http://auth-service:8080/healthz) &amp;&amp; case \\\"$STATUS\\\" in 200|204) true ;; *) false ;; esac; do sleep 1; done'; echo 'http://auth-service:8080/healthz is ready'\"\n</code></pre> <p><code>wget</code> is used by default for simple HTTP(S) probes. When any of <code>httpMethod</code>, <code>httpHeaders</code>, or <code>httpExpectedStatuses</code> are set, the init container switches to <code>curl</code> which supports all three options.</p> <p>Init containers are injected idempotently \u2014 re-applying a Deployment will not duplicate them.</p>"},{"location":"reference/helm-values/","title":"Helm Values","text":"<p>Full reference for all configurable values in the <code>bootchain-operator</code> Helm chart.</p>"},{"location":"reference/helm-values/#image","title":"Image","text":"Value Default Description <code>image.repository</code> <code>ghcr.io/user-cube/bootchain-operator</code> Container image repository <code>image.tag</code> <code>\"\"</code> Image tag. Defaults to <code>.Chart.AppVersion</code> <code>image.pullPolicy</code> <code>IfNotPresent</code> Image pull policy <code>imagePullSecrets</code> <code>[]</code> List of pull secret names"},{"location":"reference/helm-values/#deployment","title":"Deployment","text":"Value Default Description <code>replicaCount</code> <code>1</code> Number of operator replicas <code>nameOverride</code> <code>\"\"</code> Override the chart name <code>fullnameOverride</code> <code>\"\"</code> Override the full release name"},{"location":"reference/helm-values/#service-account","title":"Service Account","text":"Value Default Description <code>serviceAccount.name</code> <code>\"\"</code> ServiceAccount name. Defaults to release fullname <code>serviceAccount.annotations</code> <code>{}</code> Annotations to add to the ServiceAccount"},{"location":"reference/helm-values/#rbac","title":"RBAC","text":"Value Default Description <code>rbac.create</code> <code>true</code> Create ClusterRole and ClusterRoleBinding"},{"location":"reference/helm-values/#leader-election","title":"Leader Election","text":"Value Default Description <code>leaderElection.enabled</code> <code>true</code> Enable leader election (recommended for production)"},{"location":"reference/helm-values/#resources","title":"Resources","text":"Value Default Description <code>resources.requests.cpu</code> <code>10m</code> CPU request <code>resources.requests.memory</code> <code>64Mi</code> Memory request <code>resources.limits.cpu</code> <code>500m</code> CPU limit <code>resources.limits.memory</code> <code>128Mi</code> Memory limit"},{"location":"reference/helm-values/#metrics","title":"Metrics","text":"Value Default Description <code>metrics.enabled</code> <code>true</code> Enable the metrics endpoint <code>metrics.secure</code> <code>false</code> Serve metrics over HTTPS <code>metrics.port</code> <code>8080</code> Metrics server port <code>metrics.service.type</code> <code>ClusterIP</code> Metrics Service type <code>metrics.service.annotations</code> <code>{}</code> Annotations on the metrics Service <code>metrics.serviceMonitor.enabled</code> <code>false</code> Create a Prometheus Operator ServiceMonitor <code>metrics.serviceMonitor.interval</code> <code>30s</code> Scrape interval <code>metrics.serviceMonitor.scrapeTimeout</code> <code>10s</code> Scrape timeout <code>metrics.serviceMonitor.additionalLabels</code> <code>{}</code> Extra labels on the ServiceMonitor"},{"location":"reference/helm-values/#webhooks","title":"Webhooks","text":"Value Default Description <code>webhook.enabled</code> <code>true</code> Enable admission webhooks <code>webhook.port</code> <code>9443</code> Webhook server port <code>webhook.service.type</code> <code>ClusterIP</code> Webhook Service type <code>webhook.certManager.enabled</code> <code>true</code> Use cert-manager for TLS certificate provisioning <code>webhook.certManager.duration</code> <code>8760h</code> Certificate duration (1 year) <code>webhook.certManager.renewBefore</code> <code>720h</code> Certificate renewal window (30 days)"},{"location":"reference/helm-values/#crds","title":"CRDs","text":"Value Default Description <code>crds.install</code> <code>true</code> Install the BootDependency CRD <code>crds.keep</code> <code>true</code> Retain the CRD when the release is uninstalled"},{"location":"reference/helm-values/#scheduling","title":"Scheduling","text":"Value Default Description <code>nodeSelector</code> <code>{}</code> Node selector for the operator pod <code>tolerations</code> <code>[]</code> Tolerations for the operator pod <code>affinity</code> <code>{}</code> Affinity rules for the operator pod"},{"location":"reference/helm-values/#pod","title":"Pod","text":"Value Default Description <code>podAnnotations</code> <code>{}</code> Annotations added to the operator pod <code>podLabels</code> <code>{}</code> Extra labels added to the operator pod"},{"location":"reference/helm-values/#examples","title":"Examples","text":""},{"location":"reference/helm-values/#minimal-install-webhooks-disabled","title":"Minimal install (webhooks disabled)","text":"<pre><code>helm install bootchain-operator charts/bootchain-operator \\\n  --set webhook.enabled=false\n</code></pre>"},{"location":"reference/helm-values/#enable-prometheus-scraping","title":"Enable Prometheus scraping","text":"<pre><code>helm install bootchain-operator charts/bootchain-operator \\\n  --set metrics.serviceMonitor.enabled=true \\\n  --set metrics.serviceMonitor.additionalLabels.release=prometheus\n</code></pre>"},{"location":"reference/helm-values/#custom-image","title":"Custom image","text":"<pre><code>helm install bootchain-operator charts/bootchain-operator \\\n  --set image.repository=my-registry/bootchain-operator \\\n  --set image.tag=v1.2.3\n</code></pre>"},{"location":"reference/metrics/","title":"Metrics","text":"<p>bootchain-operator exposes Prometheus metrics via an HTTP endpoint on port <code>8080</code> (default).</p>"},{"location":"reference/metrics/#custom-metrics","title":"Custom metrics","text":"Metric Type Labels Description <code>bootchain_reconcile_total</code> Counter <code>result</code> Total reconciliations, partitioned by result <code>bootchain_reconcile_duration_seconds</code> Histogram <code>result</code> Duration of each reconciliation in seconds <code>bootchain_dependencies_total</code> Gauge <code>namespace</code>, <code>name</code> Total declared dependencies per BootDependency <code>bootchain_dependencies_ready</code> Gauge <code>namespace</code>, <code>name</code> Currently reachable dependencies per BootDependency"},{"location":"reference/metrics/#label-values","title":"Label values","text":"<p><code>result</code>: <code>success</code> | <code>error</code></p>"},{"location":"reference/metrics/#example-output","title":"Example output","text":"<pre><code># HELP bootchain_reconcile_total Total number of BootDependency reconciliations, partitioned by result.\n# TYPE bootchain_reconcile_total counter\nbootchain_reconcile_total{result=\"success\"} 42\nbootchain_reconcile_total{result=\"error\"} 1\n\n# HELP bootchain_reconcile_duration_seconds Duration of BootDependency reconciliation in seconds.\n# TYPE bootchain_reconcile_duration_seconds histogram\nbootchain_reconcile_duration_seconds_bucket{result=\"success\",le=\"0.01\"} 38\nbootchain_reconcile_duration_seconds_sum{result=\"success\"} 0.412\nbootchain_reconcile_duration_seconds_count{result=\"success\"} 42\n\n# HELP bootchain_dependencies_total Total number of declared dependencies for a BootDependency resource.\n# TYPE bootchain_dependencies_total gauge\nbootchain_dependencies_total{name=\"payments-api\",namespace=\"default\"} 2\n\n# HELP bootchain_dependencies_ready Number of dependencies currently reachable for a BootDependency resource.\n# TYPE bootchain_dependencies_ready gauge\nbootchain_dependencies_ready{name=\"payments-api\",namespace=\"default\"} 1\n</code></pre>"},{"location":"reference/metrics/#controller-runtime-metrics","title":"controller-runtime metrics","text":"<p>In addition to the custom metrics above, controller-runtime exposes standard Kubernetes controller metrics:</p> Metric Description <code>controller_runtime_reconcile_total</code> Reconcile calls by controller and result <code>controller_runtime_reconcile_time_seconds</code> Reconcile duration by controller <code>controller_runtime_webhook_requests_total</code> Webhook requests by webhook and HTTP status <code>controller_runtime_webhook_latency_seconds</code> Webhook handler latency <code>workqueue_*</code> Work queue depth, latency, and throughput"},{"location":"reference/metrics/#accessing-metrics","title":"Accessing metrics","text":""},{"location":"reference/metrics/#via-port-forward","title":"Via port-forward","text":"<pre><code>kubectl port-forward svc/bootchain-operator-metrics 8080:8080 \\\n  -n bootchain-operator-system\ncurl http://localhost:8080/metrics\n</code></pre>"},{"location":"reference/metrics/#via-prometheus-operator","title":"Via Prometheus Operator","text":"<p>Enable the ServiceMonitor in the Helm chart:</p> <pre><code>helm upgrade bootchain-operator charts/bootchain-operator \\\n  --set metrics.serviceMonitor.enabled=true \\\n  --set metrics.serviceMonitor.additionalLabels.release=prometheus\n</code></pre> <p>The <code>additionalLabels</code> must match your Prometheus instance's <code>serviceMonitorSelector</code>.</p>"},{"location":"reference/metrics/#suggested-alerts","title":"Suggested alerts","text":"<pre><code>groups:\n- name: bootchain-operator\n  rules:\n  - alert: BootDependencyReconcileErrors\n    expr: rate(bootchain_reconcile_total{result=\"error\"}[5m]) &gt; 0\n    for: 5m\n    annotations:\n      summary: \"bootchain-operator reconcile errors\"\n\n  - alert: BootDependencyUnresolved\n    expr: bootchain_dependencies_ready &lt; bootchain_dependencies_total\n    for: 10m\n    annotations:\n      summary: \"BootDependency {{ $labels.namespace }}/{{ $labels.name }} has unresolved dependencies\"\n</code></pre>"}]}